# Cursor Rules for Warden

## How to Invoke

User must explicitly reference "Warden" for Cursor to use this skill:

**Correct**:
- "Run the Warden skill"
- "Execute Warden on my PRs"

**Required**: Have Warden repository in workspace so Cursor reads this .cursorrules file.

## Cleanup Operations

User requests: "Clean up Warden workspaces", "Clear Warden data", etc.

Execute: Determine workspace root (config or `/tmp/warden-repos`), show disk usage, delete workspaces, report freed space. Preserves config files and working directory. See [CONFIGURATION.md](docs/CONFIGURATION.md).

## About Warden

Warden v1.2: Cross-platform AI skill for comprehensive automated PR review and fixes with contextual review, streamlined configuration (25 core parameters + config file support), and 1.2-1.7x performance improvement.

**Execution Mode**: Executes actual commands and checks exit codes (see AGENTS.md).

See [docs/COMMANDS.md](docs/COMMANDS.md) for command discovery details.

## Workflow Overview

Analyzes three issue sources (CI failures, review comments, code quality):

6-phase workflow:
1. **Discovery** - Batch API call to list PRs, auto-select top 10 by priority if >10 found
2. **Analysis** - ALL subagents for ALL PRs analyzing all three issue sources
3. **Planning** - Aggregate all sources, deduplicate, prioritize
4. **User Interaction** - **MANDATORY: Compile report, ask approval, WAIT for response**
5. **Execution** - Fix all issue types, validate (build/lint/test), push
6. **Summary** - Metrics and next steps

See [README.md](README.md) for complete documentation.

**Defaults**: Standard review, Affected tests, Balanced fixes. **Batching**: Max 5 PRs/batch. See AGENTS.md.

## Phase 4: User Interaction (MANDATORY)

**CRITICAL**: Must consolidate findings, present report, get approval, and WAIT before execution.

**See**: AGENTS.md Phase 4 for complete user interaction requirements.

## ⚠️ Cursor Tool Limitations (Needs Verification)

**Unknown**: Whether Cursor Composer subagents have access to `gh` CLI.

**If subagents DON'T have `gh` access** (similar to Copilot):
- Use workaround: Main agent pre-fetches PR data, saves to local files
- Pass file paths to subagents instead of PR numbers
- See `.github/copilot-instructions.md` Phase 2 for detailed workaround pattern

**If subagents DO have `gh` access** (similar to Claude Code):
- Subagents can directly call `gh pr view`, `gh pr checks`, etc.
- No workaround needed

**Action needed**: Test and document Cursor's actual capabilities.

## Cursor-Specific Optimizations

### Using Composer

**Phase 2: Analysis**
- Use Composer to analyze multiple PRs in one context window
- Leverage codebase-wide context for cross-file dependencies

**Phase 5: Execution**
- Use Composer for multi-file edits
- Select all affected files before initiating fixes
- Use "Apply to all" for similar patterns across files

### Codebase Context

**Leverage Cursor's codebase understanding**:
- Cross-reference similar code patterns
- Identify related files not directly changed in PR
- Understand project conventions automatically

### Rules Integration

**Language-specific rules**:
- Cursor automatically applies language-specific formatting
- Respect existing .cursorrules in target repository
- Follow project conventions detected from codebase

## Key Optimizations

**Parallel**: Launch all analysis simultaneously (2.5x faster)
**Incremental**: Fix/test/commit by severity tier, rollback per-tier
**Targeted**: Shallow clones, test only affected packages, format only changed files
**Background**: Non-blocking cleanup

**Performance**: 167s-240s vs 291s = **1.2-1.7x faster** (config-dependent)

## Implementation Guidelines

1. **Use Composer for multi-file analysis and edits**
2. **Leverage codebase-wide context**
3. **Batch API calls** - `gh pr list --json`
4. **Shallow clone** - `--depth=1` (unless `--reuse-workspace`)
5. **Test according to strategy** - Respect `--test-strategy` setting
6. **Incremental fixes** - By severity tier
7. **Never modify user's working directory**
8. **Respect configuration** - All 40+ parameters
9. **Never comment on PR by default** - only post PR comments if user explicitly requests it or passes `--comment-on-pr`
10. **Apply file filters** - Honor `--ignore-paths` and `--focus-paths`

## Subagent Selection

- **Simple** (1-5 lines): Direct edits in Composer
- **Moderate** (5-20 lines): Composer with focused context
- **Complex** (20+ lines): Composer mode with all affected files
- **Very Complex** (>5 files, architectural): Flag for manual review

## Language Commands

Auto-detect and adapt (only changed files):
- **Go**: `gofmt -s -w`, `go test -v ./package/...`
- **Python**: `black`, `pytest path/ -v`
- **JavaScript/TypeScript**: `prettier --write`, `npm test -- --changedSince=origin/main`
- **Rust**: `cargo fmt`, `cargo test --package`

## Error Handling

**Graceful degradation**, **per-tier rollback**, **continue on failure**

See [AGENTS.md](AGENTS.md) and [README.md](README.md) for full details.
